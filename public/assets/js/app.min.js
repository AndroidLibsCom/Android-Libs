init.push(function(){loadGitHubStats();searchLibraries();searchCategories();suggestImage();setupSubmit();prepareSharrreButtons();prepareSharrreCountersButtons();$(".enable-select2").select2();$(".max-length-input").maxlength({alwaysShow:true})});function loadGitHubStats(){var a=$(".lib-row .box");a.each(function(){var b=$(this);var c=parseInt(b.attr("data-lib-id"));$.ajax({url:baseUrl+"/lib/get/stats",type:"get",data:{id:c},success:function(d){if(!d.isGitHub){b.find(".gh-issues").html("&mdash;");b.find(".gh-starred").html("&mdash;");return false}b.find(".gh-issues").html(d.issues);b.find(".gh-starred").html(d.starred)},error:function(){b.find(".gh-issues").html('<i class="fa fa-fw fa-exclamation-triangle"></i> ERROR');b.find(".gh-starred").html('<i class="fa fa-fw fa-exclamation-triangle"></i> ERROR')}})})}function searchLibraries(){var a=$(".input-search");var b=$(".btn-search");var c=$(".search-form");function e(g){var f="<table class='library-result'><tr>";if(g.img!=null){var h=JSON.parse(g.img)[0];f+="<td class='library-image' style='vertical-align: top'><img src='"+baseUrl+"/assets/img/libs/"+h+".png' style='border: 1px solid #e7e7e7;max-width: 60px; display: inline-block; margin-right: 10px; margin-left: 10px;' /></td>"}else{f+="<td class='library-image' style='vertical-align: top'><img src='"+baseUrl+"/assets/img/lib_placeholder.png' style='border: 1px solid #e7e7e7;max-width: 60px; display: inline-block; margin-right: 10px; margin-left: 10px;' /></td>"}f+="<td class='library-info'><div class='library-title' style='font-weight: 600; color: #000; margin-bottom: 6px;'>"+g.title+"</div>";if(g.categories!=null){f+="<div class='library-category'>"+g.categories.name+"</div>"}f+="</td></tr></table>";return f}function d(f){return f.title}a.select2({placeholder:"Search for a library",minimumInputLength:1,ajax:{url:baseUrl+"/search/libraries/",type:"post",dataType:"json",data:function(f){return{query:f}},results:function(f){$.each(f,function(g,h){h.id=h.slug});return{results:f}}},initSelection:function(f){console.log(f)},formatResult:e,formatSelection:d,dropdownCssClass:"bigdrop",escapeMarkup:function(f){return f}});a.on("change",function(){window.location.href=baseUrl+"/lib/"+a.val()})}function searchCategories(){var a=$(".inputCategory");var b=$(".btn-category");var c=$(".category-form");a.change(function(){if(a.find("option:selected").val().length>0){if(a.find("option:selected").val()=="null"){window.location.href=baseUrl}else{window.location.href=baseUrl+"/search/"+a.find("option:selected").val()}}else{alert("Please select a valid category.")}})}function suggestImage(){var b=$(".suggest-image-preview");var d=$(".btn-suggest-image");var a=$(".suggest-image-input");var c=$(".suggest-image-url-input");var e=$(".suggest-image-form");a.on("change",function(){previewImg(this,b)});d.click(function(g){g.preventDefault();var f=false;setSuggestErrors(false,"",c,a);if(c.val().length>0&&a.val().length>0){setSuggestErrors(true,"You can not fill both fields.",c,a)}else{if(c.val().length==0&&a.val().length==0){setSuggestErrors(true,"Please fill at least one input.",c,a)}else{f=true}}if(f){e.submit()}})}function prepareSharrreCountersButtons(){var a=$(".sharrre-counters");a.each(function(){$(this).click(function(f){f.preventDefault()});var c=$(this).hasClass("facebook");var d=$(this).hasClass("twitter");var b=$(this).hasClass("gplus");if(c){$(this).sharrre({share:{facebook:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("facebook")},template:'<i class="fa fa-fw fa-facebook"></i> Facebook <span class="badge badge-default pull-right">{total}</span>'})}else{if(d){$(this).sharrre({share:{twitter:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("twitter")},template:'<i class="fa fa-fw fa-twitter"></i> Twitter <span class="badge badge-default pull-right">{total}</span>'})}else{if(b){$(this).sharrre({share:{googlePlus:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("googlePlus")},template:'<i class="fa fa-fw fa-google-plus"></i> Google+ <span class="badge badge-default pull-right">{total}</span>'})}}}})}function prepareSharrreButtons(){var a=$(".sharrre");a.each(function(){$(this).click(function(f){f.preventDefault()});var c=$(this).hasClass("facebook");var d=$(this).hasClass("twitter");var b=$(this).hasClass("gplus");if(c){$(this).sharrre({share:{facebook:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("facebook")},template:'<span class="btn-label icon fa fa-facebook"></span> Facebook'})}else{if(d){$(this).sharrre({share:{twitter:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("twitter")},template:'<span class="btn-label icon fa fa-twitter"></span> Twitter'})}else{if(b){$(this).sharrre({share:{googlePlus:true},enableTracking:true,click:function(e){e.simulateClick();e.openPopup("googlePlus")},template:'<span class="btn-label icon fa fa-google-plus"></span> Google+'})}}}})}function setupSubmit(){var b=$(".inputImage");var a=$(".add-prev-img");b.on("change",function(){previewImg(this,a)})}window.PixelAdmin.start(init);function previewImg(c,b){if(c.files&&c.files[0]){var a=new FileReader();a.onload=function(){b.attr("src",a.result)};a.readAsDataURL(c.files[0])}}function setSuggestErrors(c,d,b,a){if(c){b.closest("div.form-group").addClass("has-error");a.closest("div.form-group").addClass("has-error");b.closest("div.form-group").find(".help-block").html(d).show();a.closest("div.form-group").find(".help-block").html(d).show()}else{b.closest("div.form-group").removeClass("has-error");a.closest("div.form-group").removeClass("has-error");b.closest("div.form-group").find(".help-block").hide();a.closest("div.form-group").find(".help-block").hide()}};